- name: Deploy app via SSH
  run: |
    ssh -i ~/.ssh/id_rsa ${{ secrets.VM_USER }}@${{ secrets.VM_HOST }} << 'EOF'
      set -e
      set -x

      echo "ðŸ“‚ Changing to project directory..."
      cd /var/www/your-app/nodejsprojectingithub || { echo "âŒ Directory not found"; exit 1; }

      echo "ðŸ“ Listing files in /mnt"
      ls -l /mnt

      echo "ðŸ“„ Checking if /mnt/.env exists"
      if [ -f /mnt/.env ]; then
        echo "âœ… Found /mnt/.env. Backing up existing .env..."
        [ -f .env ] && mv .env .env.bak
        cp /mnt/.env .env
      else
        echo "âŒ /mnt/.env does not exist. Skipping copy."
      fi

      echo "âž¡ Pulling latest code from Git..."
      git fetch origin main
      git reset --hard origin/main
      git clean -fd

      echo "ðŸ“¦ Installing dependencies..."
      npm install

      echo "ðŸš€ Starting or restarting app with PM2..."
      if pm2 list | grep -q "your-app"; then
        pm2 restart your-app
      else
        pm2 start app.js --name your-app
      fi

      echo "ðŸ’¾ Saving PM2 process list..."
      pm2 save
    EOF
